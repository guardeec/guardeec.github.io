<head></head>
<style></style>
<body>
    <div id="graph"></div>
    <script src="//unpkg.com/3d-force-graph"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>
        let div = document.getElementById("graph");
        d3.json("https://guardeec.github.io/graph_366_4.json", function (error, d) {
            let myGraph = ForceGraph3D();
            myGraph(div).graphData(d).forceEngine("d3");

            myGraph.nodeColor(function (d) {
                return d3.rgb(120, 130, 255);
                //return d3.rgb(255, 255, 255);
            });

            myGraph.d3Force("charge").strength(function (d) {
                return -1000;
            });
            myGraph.d3Force("link").distance(function (d) {
                return 500;
            });
            myGraph.d3Force("link").strength(function (d) {
                return 0.3;
            });
            myGraph.d3Force('collide', d3.forceCollide(myGraph.nodeRelSize()));

            let previous = 0;
            let interval = setInterval(function () {
                p = d.nodes[0].x;
                if (previous !== p) {
                    previous = p;
                } else {

                    let newNodes = [];
                    d.nodes.forEach(function (node) {
                        newNodes.push({
                            id: node.id,
                            x: node.x,
                            y: node.y,
                            z: node.z
                        });
                    });

                    let newLinks = [];
                    d.links.forEach(function (link) {
                        newLinks.push({
                            source: link.source.id,
                            target: link.target.id
                        })
                    });
                    let graph = {
                        nodes: newNodes,
                        links: newLinks
                    };
                    clearInterval(interval);
                }
            }, 2000);
        });

</script>
</body>